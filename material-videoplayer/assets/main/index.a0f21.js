System.register("chunks:///_virtual/MaterialPlayVideoTool.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var i,t,o,r,a,n,l,s,u,c,p,d,v,y,h,m,f,_,P,T,g;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,o=e.createClass,r=e.initializerDefineProperty,a=e.assertThisInitialized,n=e.defineProperty},function(e){l=e.cclegacy,s=e._decorator,u=e.Enum,c=e.AudioSource,p=e.Material,d=e.Size,v=e.CCFloat,y=e.VideoClip,h=e.tween,m=e.ImageAsset,f=e.Texture2D,_=e.input,P=e.Input,T=e.AudioClip,g=e.Component}],execute:function(){var b,w,S,C,L,R,A,z,U,k,O,V,x,F,M,D,E,I,j,q,H,B;e("VideoResType",void 0),l._RF.push({},"48a9214D1pCMIYUhQfVMmM/","MaterialPlayVideoTool",void 0);var Q,Y=s.ccclass,G=s.property,J=s.requireComponent;!function(e){e[e.URL=0]="URL",e[e.LOCAL=1]="LOCAL"}(Q||(Q=e("VideoResType",{}))),u(Q);e("MaterialPlayVideoTool",(b=Y("MaterialPlayVideoTool"),w=J(c),S=G({type:c,tooltip:"视频音频播放器"}),C=G({type:p,tooltip:"播放的材质球,默认修改mainTexture属性"}),L=G({type:d,tooltip:"视频尺寸(影响性能)"}),R=G({type:v,slide:!0,step:.1,range:[.1,1],tooltip:"视频播放速度(影响性能)"}),A=G({type:v,slide:!0,step:.1,range:[0,1],tooltip:"视频声音大小"}),z=G({tooltip:"是否自动播放"}),U=G({tooltip:"是否点击任意地方播放(微信中无法自动播放，需要用户点击一次页面才可以)"}),k=G({type:Q,tooltip:"视频源类型"}),O=G({tooltip:"远程视频链接，需要支持跨域",visible:function(){return this.videoResType===Q.URL}}),V=G({type:y,visible:function(){return this.videoResType===Q.LOCAL}}),b(x=w((M=i((F=function(e){function i(){for(var i,t=arguments.length,o=new Array(t),l=0;l<t;l++)o[l]=arguments[l];return i=e.call.apply(e,[this].concat(o))||this,r(a(i),"audioSource",M,a(i)),r(a(i),"mat",D,a(i)),r(a(i),"videoSize",E,a(i)),r(a(i),"videoSpeed",I,a(i)),r(a(i),"videoVolume",j,a(i)),n(a(i),"autoPlay",!0),n(a(i),"clickPlay",!1),r(a(i),"videoResType",q,a(i)),r(a(i),"videoURL",H,a(i)),r(a(i),"videoClip",B,a(i)),n(a(i),"_video",void 0),n(a(i),"_canvas",void 0),n(a(i),"context",void 0),n(a(i),"frames",[]),n(a(i),"currentFrame",0),n(a(i),"isPlay",!1),n(a(i),"playTween",void 0),i}t(i,e);var l=i.prototype;return l.start=function(){var e=this;this.audioSource||(this.audioSource=this.getComponent(c)),this.audioSource.playOnAwake=!0,this._canvas=document.createElement("canvas"),this._canvas.id="canvas_video",this._canvas.width=this.videoSize.width,this._canvas.height=this.videoSize.height,this.context=this._canvas.getContext("2d"),this._canvas.setAttribute("crossOrigin","anonymous");var i=1/this.videoSpeed*.1;this.playTween=h(this.node).delay(i),this.videoResType===Q.LOCAL?(this._video=this.videoClip._nativeAsset,this._canvas.appendChild(this._video)):this._video=document.createElement("video"),this._video.id="video",this._video.muted=!0,this._video.volume=this.videoVolume,this._video.autoplay=!1,this._video.loop=!1,this._video.crossOrigin="anonymous",this._video.canPlayType("video/mp4");this._video.addEventListener("ended",(function i(){e.isPlay=!1,e._video.removeEventListener("ended",i)})),this.videoResType===Q.URL?(this._video.src=this.videoURL?this.videoURL:"https://stream7.iqilu.com/10339/upload_transcode/202002/18/20200218114723HDu3hhxqIT.mp4",this.playTween.call((function(){e.audioSource.clip||e.initAudio()}))):this.initAudio(),this.playTween.call((function(){try{if(e.isPlay){e.context.drawImage(e._video,0,0,e.videoSize.width,e.videoSize.height);var i=new m;i.reset(e._canvas);var t=new f;t.image=i,e.mat.setProperty("mainTexture",t),e.frames.push(t)}else{if(e.frames.length<=0)return;e.mat.setProperty("mainTexture",e.frames[e.currentFrame]),e.currentFrame=(e.currentFrame+1)%e.frames.length}}catch(e){console.error(e)}})).union().repeatForever(),this.autoPlay&&this.play(),_.once(P.EventType.TOUCH_START,(function(){e.clickPlay?e.play():e.isPlay?e.audioSource.currentTime=e._video.currentTime:e.audioSource.currentTime=e.currentFrame/e.frames.length*(i*e.frames.length)}),this)},l.initAudio=function(){var e=new T;e._nativeAsset={player:null,duration:this._video.duration,type:0,url:this.videoResType===Q.URL?this._video.currentSrc:this.videoClip.nativeUrl},this.audioSource.clip=e,this.audioSource.loop=!0,this.audioSource.volume=this.videoVolume},l.play=function(){this._video.play(),this.isPlay=!0,this.audioSource.play(),this.playTween.start()},l.stop=function(){this._video.pause(),this.playTween.stop()},o(i,[{key:"AudioPlay",get:function(){return this.autoPlay},set:function(e){this.autoPlay=e,this.clickPlay=!e}},{key:"ClickPlay",get:function(){return this.clickPlay},set:function(e){this.clickPlay=e,this.autoPlay=!e}}]),i}(g)).prototype,"audioSource",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=i(F.prototype,"mat",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=i(F.prototype,"videoSize",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d(320,240)}}),I=i(F.prototype,"videoSpeed",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),j=i(F.prototype,"videoVolume",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),i(F.prototype,"AudioPlay",[z],Object.getOwnPropertyDescriptor(F.prototype,"AudioPlay"),F.prototype),i(F.prototype,"ClickPlay",[U],Object.getOwnPropertyDescriptor(F.prototype,"ClickPlay"),F.prototype),q=i(F.prototype,"videoResType",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Q.URL}}),H=i(F.prototype,"videoURL",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),B=i(F.prototype,"videoClip",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=F))||x)||x));l._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./MaterialPlayVideoTool.ts"],(function(){"use strict";return{setters:[null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});